<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <title>Os 100</title>

    <!-- Favicon externo (sem data-URI) -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        /* ---------- BASE ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif
        }

        body {
            background: #f0f0f0;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 1rem;
            min-height: 100vh;
            text-align: center
        }

        h1 {
            width: 100%;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem
        }

        /* ---------- CARTÕES ---------- */
        .card {
            width: 100%;
            max-width: 480px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
            padding: 1.5rem;
            margin-top: 20px
        }

        /* ---------- FORM ---------- */
        label {
            display: block;
            margin: .75rem 0;
            font-weight: bold;
            text-align: left
        }

        input[type=text],
        input[type=number] {
            width: 100%;
            padding: .75rem;
            margin-top: .25rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #f9f9f9
        }

        input:focus {
            border-color: #1976d2;
            outline: none
        }

        button {
            width: 100%;
            padding: .75rem 1.5rem;
            margin-top: 1rem;
            font-size: 1rem;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            color: #fff;
            background: #1976d2;
            cursor: pointer
        }

        button:hover:not(:disabled) {
            background: #1565c0
        }

        button:disabled {
            background: #bbb;
            cursor: not-allowed
        }

        /* ---------- TABELAS ---------- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem
        }

        th,
        td {
            padding: .75rem;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 1rem
        }

        th {
            background: #1976d2;
            color: #fff
        }

        tr:nth-child(even) {
            background: #f9f9f9
        }

        td input[type=number] {
            width: 60px;
            padding: .25rem;
            margin-right: .5rem
        }

        td button {
            padding: .5rem 1rem;
            font-size: .875rem
        }

        /* ---------- RESPONSIVO ---------- */
        @media(max-width:600px) {
            h1 {
                font-size: 1.5rem
            }

            .card {
                padding: 1rem
            }

            input,
            button {
                font-size: .9rem;
                padding: .5rem
            }

            th,
            td {
                padding: .5rem;
                font-size: .875rem
            }
        }
    </style>
</head>

<body>

    <h1>Os 100</h1>

    <!-- SETUP -------------------------------------------------------------->
    <section id="setup" class="card">
        <label>Nº de jogadores:
            <input id="numPlayers" type="number" min="1" max="10" value="2">
            <button id="btnSetPlayers" type="button">Definir jogadores</button>
        </label>

        <div id="playersInputs"></div>

        <label>Pontuação-alvo:
            <input id="targetScore" type="number" value="100">
        </label>
        <label>Penalidade se ultrapassar:
            <input id="penalty" type="number" value="50">
        </label>

        <button id="startGame" type="button">Iniciar jogo</button>
    </section>

    <!-- JOGO --------------------------------------------------------------->
    <section id="game" class="card" style="display:none">
        <table id="scoreTable"></table>
        <button id="resetRound" type="button">Zerar placar atual</button>
        <button id="resetGame" type="button">Reiniciar</button>
    </section>

    <!-- HISTÓRICO ---------------------------------------------------------->
    <section id="history" class="card" style="display:none">
        <h2>Histórico de Rodadas</h2>

        <h3>Vencedores</h3>
        <table id="winnerHistory">
            <tr>
                <th>Jogador</th>
                <th>Vitórias</th>
            </tr>
        </table>

        <h3>Placar das Rodadas</h3>
        <table id="roundHistory">
            <thead></thead>
            <tbody></tbody>
        </table>
    </section>

    <script>
        /* ---------- ESTADO ---------- */
        let state = {
            players: [], scores: [], target: 100, penalty: 50,
            started: false, roundHistory: [], winnerHistory: {}
        };

        /* ---------- PERSISTÊNCIA ---------- */
        function saveState() { localStorage.setItem('os100_state', JSON.stringify(state)); }
        function loadState() {
            const s = localStorage.getItem('os100_state');
            if (s) { state = JSON.parse(s); return true; }
            return false;
        }

        /* ---------- MOSTRAR/OCULTAR ---------- */
        function showSetup() {
            document.getElementById('setup').style.display = 'block';
            document.getElementById('game').style.display = 'none';
            document.getElementById('history').style.display = 'none';
        }
        function showGame() {
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            document.getElementById('history').style.display = 'block';
        }

        /* ---------- UI DO JOGO ---------- */
        function buildGameUI() {
            const tbl = document.getElementById('scoreTable');
            tbl.innerHTML = '<tr><th>Jogador</th><th>Pontos</th><th>Adicionar</th></tr>';
            state.players.forEach((nome, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${nome}</td>
            <td id="score_${i}">${state.scores[i]}</td>
            <td>
                <input type="number" enterkeyhint="done" autocomplete="off" placeholder="+/-">
                <button>OK</button>
            </td>`;
                const inp = tr.querySelector('input'), btn = tr.querySelector('button');
                btn.onclick = () => { processPoints(i, +inp.value); inp.value = ''; inp.focus(); };
                inp.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); btn.click(); } });
                tbl.appendChild(tr);
            });
            updateRoundHistory();
        }

        /* ---------- HISTÓRICOS ---------- */
        function updateWinnerHistory() {
            const tbl = document.getElementById('winnerHistory');
            tbl.innerHTML = '<tr><th>Jogador</th><th>Vitórias</th></tr>';
            Object.entries(state.winnerHistory).forEach(([p, v]) => {
                tbl.insertAdjacentHTML('beforeend', `<tr><td>${p}</td><td>${v}</td></tr>`);
            });
        }
        function updateRoundHistory() {
            const tbl = document.getElementById('roundHistory');
            const thead = tbl.tHead || tbl.createTHead();
            const tbody = tbl.tBodies[0] || tbl.createTBody();
            thead.innerHTML = '';
            const hr = thead.insertRow();
            hr.insertCell().outerHTML = '<th>Rodada</th>';
            state.players.forEach(p => {
                const th = document.createElement('th');
                th.textContent = p;
                hr.appendChild(th);
            });
            tbody.innerHTML = '';
            state.roundHistory.forEach(r => {
                const tr = tbody.insertRow();
                tr.insertCell().textContent = `Rodada ${r.round}`;
                r.scores.forEach(s => tr.insertCell().textContent = s);
            });
        }

        /* ---------- LÓGICA DE PONTUAÇÃO ---------- */
        function processPoints(idx, pts) {
            if (!pts) return;
            const newScore = state.scores[idx] + pts;
            if (newScore < 0) { alert('Pontuação não pode ficar negativa.'); return; }
            state.scores[idx] = newScore;

            /* vitória */
            if (state.scores[idx] === state.target) {
                alert(`${state.players[idx]} venceu!`);
                state.winnerHistory[state.players[idx]] = (state.winnerHistory[state.players[idx]] || 0) + 1;
                state.roundHistory.push({ round: state.roundHistory.length + 1, scores: state.scores.slice() });
                updateWinnerHistory();
                updateRoundHistory();
                state.scores = state.scores.map(() => 0);
                buildGameUI();
                saveState();
                return;
            }

            /* passou da meta */
            if (pts > 0 && state.scores[idx] > state.target) {
                state.scores[idx] = state.penalty;
                alert(`${state.players[idx]} passou de ${state.target}! Volta para ${state.penalty}.`);
            }
            document.getElementById(`score_${idx}`).textContent = state.scores[idx];
            saveState();
        }

        /* ---------- BOTÕES PRINCIPAIS ---------- */
        document.getElementById('btnSetPlayers').onclick = () => {
            const n = +document.getElementById('numPlayers').value || 0;
            const div = document.getElementById('playersInputs');
            div.innerHTML = '';
            for (let i = 0; i < n; i++) {
                div.insertAdjacentHTML('beforeend',
                    `<input type="text" placeholder="Nome do jogador ${i + 1}"><br>`);
            }
        };

        document.getElementById('startGame').onclick = () => {
            const inputs = document.querySelectorAll('#playersInputs input');
            if (!inputs.length) { alert('Clique em "Definir jogadores" primeiro.'); return; }
            state.players = [];
            state.scores = [];
            inputs.forEach((inp, j) => {
                state.players.push(inp.value.trim() || `Jogador ${j + 1}`);
                state.scores.push(0);
            });
            state.target = parseInt(document.getElementById('targetScore').value) || 100;
            state.penalty = parseInt(document.getElementById('penalty').value) || 50;
            state.started = true;
            showGame();
            buildGameUI();
            updateWinnerHistory();
            saveState();
        };

        document.getElementById('resetRound').onclick = () => {
            if (confirm('Zerar o placar atual?')) {
                state.scores = state.scores.map(() => 0);
                buildGameUI();
                saveState();
            }
        };
        document.getElementById('resetGame').onclick = () => {
            if (confirm('Reiniciar e apagar TUDO?')) {
                localStorage.removeItem('os100_state');
                location.reload();
            }
        };

        /* ---------- INICIALIZAÇÃO ---------- */
        window.onload = () => {
            if (loadState() && state.started) {
                showGame();
                buildGameUI();
                updateWinnerHistory();
            } else {
                showSetup();
            }
        };
    </script>
</body>

</html>